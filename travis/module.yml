# Travis CI configuration file for a WordPoints module.

language: php

# 5.3 runs first so that we can fail fast on the codesniff pass (see below).
php:
    - 5.3
    - 5.2
    - 5.4
    - 5.5
    - 5.6

env:
    - TRAVISCI_RUN=codesniff
    - TRAVISCI_RUN=phpunit WP_VERSION=nightly WORDPOINTS_VERSION=master
    - TRAVISCI_RUN=phpunit WP_VERSION=nightly WORDPOINTS_VERSION=stable
    - TRAVISCI_RUN=phpunit WP_VERSION=latest WORDPOINTS_VERSION=master
    - TRAVISCI_RUN=phpunit WP_VERSION=latest WORDPOINTS_VERSION=stable
    - TRAVISCI_RUN=phpunit WP_VERSION=4.0 WORDPOINTS_VERSION=master
    - TRAVISCI_RUN=phpunit WP_VERSION=4.0 WORDPOINTS_VERSION=stable
    - TRAVISCI_RUN=phpunit WP_VERSION=3.9 WORDPOINTS_VERSION=master
    - TRAVISCI_RUN=phpunit WP_VERSION=3.9 WORDPOINTS_VERSION=stable
    - TRAVISCI_RUN=phpunit WP_VERSION=3.8 WORDPOINTS_VERSION=stable

sudo: false

matrix:
  include:
    # Only run HHVM against the latest for now.
    - php: hhvm
      env: TRAVISCI_RUN=phpunit WP_VERSION=latest
    # Only run nightly against latest.
    - php: nightly
      env: TRAVISCI_RUN=phpunit WP_VERSION=latest
  exclude:
    # The codesniff pass only needs to be run once, I chose PHP 5.3, since WPCS requires it.
    - php: 5.2
      env: TRAVISCI_RUN=codesniff
    - php: 5.4
      env: TRAVISCI_RUN=codesniff
    - php: 5.5
      env: TRAVISCI_RUN=codesniff
    - php: 5.6
      env: TRAVISCI_RUN=codesniff
  allow_failures:
    - php: hhvm
    - php: nightly
  fast_finish: true

before_script:
    - export WORDPOINTS_PROJECT_TYPE=module
    - export DEV_LIB_PATH=dev-lib
    - source $DEV_LIB_PATH/travis/before_script.sh

script:
    - codesniff-php-syntax
    - codesniff-phpcs
    - codesniff-jshint
    - codesniff-l10n
    - codesniff-xmllint
    - codesniff-bash
    - phpunit-basic
    - phpunit-ms
    - phpunit-ms-network
    - phpunit-uninstall
    - phpunit-ms-uninstall
    - phpunit-ms-network-uninstall
    - phpunit-ajax
    - phpunit-ms-ajax
    - phpunit-ms-network-ajax

after_script:
    - source $DEV_LIB_PATH/travis/after_script.sh
